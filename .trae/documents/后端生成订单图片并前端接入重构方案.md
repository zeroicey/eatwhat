## 后端改造
- 新增工具模块：`apps/api/src/utils/orderImage.js`，把 `apps/test/main.js` 的核心绘图逻辑迁移过来，封装为 `generateOrderImage(groups, options)` 返回 `{ buffer, width, height, dataUrl }`。
- 统一使用图标：将 `apps/test/images/money.png`、`apps/test/images/heart.png` 拷贝到 `apps/api/src/utils/images/`，工具模块使用相对路径 `path.resolve(__dirname, 'images', 'money.png')`/`heart.png` 加载。若图标缺失时报错降级为字符绘制（但默认会有图标）。
- 去除测试数据构造，改为按前端传入的购物车结构计算 `groups`（按店铺分组、每项含名称/单价/数量/备注、含小计与总计）。
- 依赖：在 `@eatwhat/api` 增加 `canvas`（node-canvas）依赖；使用 `canvas.toBuffer('image/png')` 及 `toDataURL` 生成 PNG 与 Base64。
- 新增路由与控制器：
  - 路由文件：`apps/api/src/routes/toolsRoutes.js`
  - 控制器文件：`apps/api/src/controllers/toolsController.js`
  - 挂载路径：`/api/tools/order-image`（`POST`）
  - 中间件：使用 `optionalAuth`（可携带用户信息但不强制登录）。
- 统一响应：使用现有 `utils/response.js` 的 `success`/`error` 封装，前端拦截器可直接解析。
- 入参与出参约定：
  - 请求体：
    ```json
    {
      "title": "今天吃什么 · 清单",
      "cart": {
        "\u003cstoreId\u003e": {
          "storeInfo": { "name": "店铺名" },
          "items": [
            { "name": "菜品", "price": 25, "quantity": 2, "note": "少辣" }
          ]
        }
      },
      "style": { "theme": "light" }
    }
    ```
  - 响应体（HTTP 200）：
    ```json
    {
      "success": true,
      "message": "Success",
      "data": {
        "mimeType": "image/png",
        "width": 420,
        "height": 600,
        "dataUrl": "data:image/png;base64,...."
      }
    }
    ```
- 校验与限制：校验 `price>0`、`quantity>=1`，限制总行数避免过大图片（如最多 200 行，超过则截断并在底部标注）。

## 前端重构（`pages/cart/preview.vue`）
- 删除本地 `<canvas>` 及所有绘制逻辑（`calcHeight`/`draw`/`generate` 等）。
- 保留页面布局与按钮；新增生成方法：
  - 调用 `post('/tools/order-image', { title, cart: cartStore.items })`。
  - 返回后将 `dataUrl` 绑定到 `<image :src="imagePath" mode="widthFix" />`。
- 保存到相册：
  - 将 `dataUrl`（Base64）写入临时文件：
    - 提取 Base64：`const base64 = dataUrl.split(',')[1]`
    - 使用 `wx.getFileSystemManager().writeFile({ encoding: 'base64' })` 写入 `wx.env.USER_DATA_PATH` 下的 `*.png`
    - `uni.saveImageToPhotosAlbum({ filePath })` 保存。
- 交互与容错：购物车为空时提示；请求期间按钮禁用、显示 Loading；失败时使用 `uni.showToast`。

## 路由挂载
- 在 `apps/api/src/app.js` 增加：`app.use('/api/tools', toolsRoutes)`。

## 兼容性与性能
- Base64 响应可直接用于 `<image>` 显示；保存走本地写文件→相册流程，避免后端存储依赖。
- 若未来需要分享链接或持久化，可扩展为将图片上传到 Minio 并返回 URL（保持当前接口不变，增加可选参数 `store=true`）。

## 验证与测试
- 后端：使用构造的最小购物车请求进行本地验证，断言响应结构与图片尺寸；错误路径校验（空购物车、非法字段）。
- 前端：在微信开发者工具中验证生成、展示与保存流程；空购物车与网络错误提示。

## 开发输出
- 新增文件：`src/utils/orderImage.js`、`src/utils/images/money.png`、`src/utils/images/heart.png`、`src/routes/toolsRoutes.js`、`src/controllers/toolsController.js`。
- 修改文件：`src/app.js`（挂载路由）、`pages/cart/preview.vue`（移除本地绘图，改为请求后端）。

请确认以上方案，我将按此实现、联调并完成验证。