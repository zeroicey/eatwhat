{"version":3,"file":"cart.js","sources":["stores/cart.js"],"sourcesContent":["import { defineStore } from 'pinia'\n\n/**\n * Cart Store - 购物车状态管理\n * 职责：管理跨店清单的完整生命周期\n * 持久化：使用 Pinia 持久化插件存储到 LocalStorage\n * 约束：购物车完全由前端管理，后端不提供任何购物车接口\n */\nexport const useCartStore = defineStore('cart', {\n  state: () => ({\n    // 购物车项目，按店铺分组\n    // 数据结构: { storeId: { storeInfo: {}, items: [] } }\n    items: {},\n    // 最后更新时间\n    lastUpdated: null\n  }),\n\n  getters: {\n    /**\n     * 获取所有店铺列表\n     */\n    storeList: (state) => {\n      return Object.values(state.items).map(store => store.storeInfo)\n    },\n\n    /**\n     * 获取总商品数量\n     */\n    totalItemCount: (state) => {\n      return Object.values(state.items).reduce((total, store) => {\n        return total + store.items.reduce((sum, item) => sum + item.quantity, 0)\n      }, 0)\n    },\n\n    /**\n     * 按店铺分组计算价格\n     */\n    priceByStore: (state) => {\n      const result = {}\n      Object.keys(state.items).forEach(storeId => {\n        const store = state.items[storeId]\n        result[storeId] = {\n          storeName: store.storeInfo.name,\n          subtotal: store.items.reduce((sum, item) => {\n            return sum + (item.price * item.quantity)\n          }, 0),\n          itemCount: store.items.length\n        }\n      })\n      return result\n    },\n\n    /**\n     * 计算总价\n     */\n    totalPrice: (state) => {\n      return Object.values(state.items).reduce((total, store) => {\n        return total + store.items.reduce((sum, item) => {\n          return sum + (item.price * item.quantity)\n        }, 0)\n      }, 0)\n    },\n\n    /**\n     * 检查购物车是否为空\n     */\n    isEmpty: (state) => {\n      return Object.keys(state.items).length === 0\n    }\n  },\n\n  actions: {\n    /**\n     * 添加商品到购物车\n     * @param {Object} storeInfo - 店铺信息 { id, name, ... }\n     * @param {Object} item - 商品信息 { id, name, price, ... }\n     * @param {Number} quantity - 数量\n     */\n    addItem(storeInfo, item, quantity = 1) {\n      const storeId = storeInfo.id\n\n      // 如果店铺不存在，初始化\n      if (!this.items[storeId]) {\n        this.items[storeId] = {\n          storeInfo: storeInfo,\n          items: []\n        }\n      }\n\n      // 查找是否已存在该商品\n      const existingItem = this.items[storeId].items.find(i => i.id === item.id)\n\n      if (existingItem) {\n        // 已存在，增加数量\n        existingItem.quantity += quantity\n      } else {\n        // 不存在，添加新商品\n        this.items[storeId].items.push({\n          ...item,\n          quantity,\n          note: '' // 备注\n        })\n      }\n\n      this.lastUpdated = Date.now()\n    },\n\n    /**\n     * 删除商品\n     * @param {String} storeId - 店铺ID\n     * @param {String} itemId - 商品ID\n     */\n    removeItem(storeId, itemId) {\n      if (!this.items[storeId]) return\n\n      this.items[storeId].items = this.items[storeId].items.filter(\n        item => item.id !== itemId\n      )\n\n      // 如果店铺没有商品了，删除店铺\n      if (this.items[storeId].items.length === 0) {\n        delete this.items[storeId]\n      }\n\n      this.lastUpdated = Date.now()\n    },\n\n    /**\n     * 更新商品数量\n     * @param {String} storeId - 店铺ID\n     * @param {String} itemId - 商品ID\n     * @param {Number} quantity - 新数量\n     */\n    updateQuantity(storeId, itemId, quantity) {\n      if (!this.items[storeId]) return\n\n      const item = this.items[storeId].items.find(i => i.id === itemId)\n      if (item) {\n        if (quantity <= 0) {\n          // 数量为0，删除商品\n          this.removeItem(storeId, itemId)\n        } else {\n          item.quantity = quantity\n          this.lastUpdated = Date.now()\n        }\n      }\n    },\n\n    /**\n     * 更新商品备注\n     * @param {String} storeId - 店铺ID\n     * @param {String} itemId - 商品ID\n     * @param {String} note - 备注内容\n     */\n    updateNote(storeId, itemId, note) {\n      if (!this.items[storeId]) return\n\n      const item = this.items[storeId].items.find(i => i.id === itemId)\n      if (item) {\n        item.note = note\n        this.lastUpdated = Date.now()\n      }\n    },\n\n    /**\n     * 清空整个购物车\n     */\n    clearCart() {\n      this.items = {}\n      this.lastUpdated = Date.now()\n    },\n\n    /**\n     * 清空指定店铺的商品\n     * @param {String} storeId - 店铺ID\n     */\n    clearStore(storeId) {\n      delete this.items[storeId]\n      this.lastUpdated = Date.now()\n    },\n\n    /**\n     * 获取指定店铺的商品列表\n     * @param {String} storeId - 店铺ID\n     * @returns {Array} 商品列表\n     */\n    getStoreItems(storeId) {\n      return this.items[storeId]?.items || []\n    }\n  },\n\n  // 持久化配置 - 使用 UniApp 本地存储\n  // 注意：需要在 store 初始化时手动恢复状态\n  persist: false  // 暂时关闭自动持久化，使用手动方式\n})\n"],"names":["defineStore"],"mappings":"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"}